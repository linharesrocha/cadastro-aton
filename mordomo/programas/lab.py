import os
from pathlib import Path
import pyodbc
import warnings
import slack
import pandas as pd
from dotenv import load_dotenv

warnings.filterwarnings('ignore')

# SLACK SETUP
env_path = Path('.') / '.env'
load_dotenv(dotenv_path=env_path)
app = slack.WebClient(token=os.environ['SLACK_TOKEN'])

env_path_sql = Path('.') / '.env-sql'
load_dotenv(dotenv_path=env_path_sql)
DATABASE=os.environ['DATABASE']
UID=os.environ['UID']
PWD=os.environ['PWD']

dados_conexao = ("Driver={SQL Server};"
            "Server=erp.ambarxcall.com.br;"
            "Database="+DATABASE+";"
            "UID="+UID+";"
            "PWD="+PWD+";")

conexao = pyodbc.connect(dados_conexao)
print("Conex√£o com o Banco de Dados Bem Sucedida!")
cursor = conexao.cursor()

# GET LAST ORDER
comando = f'''
SELECT B.AUTOID, B.CODID, A.COD_INTERNO, A.DESCRICAO, B.TIPO, B.VALOR, B.PRODUTO, B.SKU, B.API, B.IDTIPO, B.TIPODADO, B.ALLOW_VARIATIONS, B.VALOR_ID, A.INATIVO
FROM MATERIAIS A
LEFT JOIN MATERIAIS_ESPECIFICACOES B
ON A.CODID = B.CODID
WHERE A.CODID IN('5', '7', '8', '9', '10', '11', '12', '13', '16', '17', '19', '20', '21', '22', '23', '24', '26', '31', '33', '34', '35', '36', '37', '41', '44', '46', '48', '49', '50', '52', '55', '59', '61', '63', '64', '66', '67', '68', '69', '70', '71', '77', '78', '80', '84', '86', '87', '88', '90', '92', '94', '95', '96', '97', '102', '103', '105', '106', '109', '111', '114', '115', '116', '117', '120', '121', '122', '123', '126', '127', '130', '131', '133', '134', '135', '138', '139', '141', '142', '143', '151', '154', '155', '156', '157', '160', '161', '162', '165', '181', '184', '188', '191', '192', '193', '200', '203', '205', '206', '207', '208', '210', '211', '212', '213', '214', '215', '217', '218', '219', '223', '226', '227', '228', '229', '231', '232', '237', '238', '239', '241', '242', '243', '244', '246', '247', '248', '252', '254', '255', '256', '257', '258', '260', '264', '266', '267', '268', '269', '272', '273', '275', '276', '278', '280', '282', '285', '289', '291', '292', '295', '296', '297', '299', '300', '301', '302', '307', '316', '317', '318', '320', '321', '322', '323', '324', '326', '327', '328', '331', '333', '337', '340', '341', '342', '349', '350', '351', '352', '353', '355', '356', '359', '360', '362', '364', '366', '367', '368', '370', '371', '372', '373', '374', '376', '377', '380', '382', '396', '399', '404', '405', '406', '407', '410', '412', '415', '416', '417', '420', '421', '422', '426', '427', '428', '432', '433', '435', '436', '437', '439', '441', '442', '443', '444', '445', '446', '449', '450', '451', '453', '454', '456', '457', '458', '460', '462', '465', '466', '468', '469', '470', '471', '473', '475', '477', '478', '480', '481', '482', '484', '485', '489', '491', '492', '493', '499', '502', '503', '515', '518', '519', '521', '522', '523', '526', '527', '528', '541', '544', '545', '547', '559', '571', '572', '579', '581', '582', '583', '585', '587', '590', '596', '597', '598', '601', '604', '605', '607', '608', '609', '611', '612', '613', '614', '616', '618', '619', '621', '622', '624', '625', '626', '627', '629', '630', '634', '635', '639', '640', '644', '645', '655', '659', '664', '670', '672', '674', '675', '676', '680', '682', '683', '684', '686', '687', '688', '692', '693', '694', '698', '701', '703', '704', '706', '708', '711', '716', '722', '728', '730', '731', '732', '733', '734', '736', '737', '738', '748', '750', '752', '753', '754', '756', '757', '758', '760', '763', '766', '771', '773', '775', '776', '777', '779', '780', '781', '782', '787', '790', '791', '796', '798', '800', '801', '803', '804', '805', '808', '809', '810', '811', '812', '819', '824', '825', '826', '827', '835', '836', '837', '838', '841', '842', '845', '846', '850', '851', '854', '855', '856', '858', '859', '860', '861', '984', '986', '1011', '1013', '1039', '1040', '1044', '1068', '1080', '1081', '1082', '1083', '1088', '1089', '1090', '1091', '1094', '1096', '1099', '1108', '1111', '1113', '1114', '1115', '1133', '1134', '1138', '1141', '1142', '1144', '1145', '1148', '1150', '1151', '1154', '1155', '1156', '1158', '1160', '1162', '1167', '1168', '1171', '1191', '1192', '1193', '1194', '1195', '1196', '1197', '1198', '1202', '1203', '1204', '1205', '1206', '1207', '1208', '1209', '1227', '1228', '1229', '1230', '1231', '1232', '1235', '1236', '1237', '1238', '1243', '1244', '1245', '1251', '1252', '1253', '1254', '1256', '1257', '1258', '1259', '1261', '1262', '1263', '1264', '1279', '1294', '1300', '1302', '1304', '1336', '1339', '1340', '1341', '1343', '1345', '1348', '1416', '1417', '1425', '1426', '1432', '1433', '1434', '1435', '1436', '1499', '1500', '1502', '1503', '1504', '1505', '1507', '1508', '1509', '1510', '1512', '1513', '1519', '1520', '1525', '1529', '1530', '1531', '1532', '1533', '1535', '1536', '1537', '1538', '1542', '1544', '1545', '1546', '1547', '1548', '1549', '1551', '1552', '1553', '1554', '1555', '1556', '1557', '1558', '1560', '1561', '1562', '1563', '1564', '1565', '1566', '1567')
    '''

data = pd.read_sql(comando, conexao)

data.to_excel('rel.xls', index=False)